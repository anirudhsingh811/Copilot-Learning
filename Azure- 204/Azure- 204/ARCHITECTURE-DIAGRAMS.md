# AZ-204 Module 1: Architecture Diagrams

## ??? Complete Architecture Overview

```
???????????????????????????????????????????????????????????????????????????
?                        AZURE COMPUTE SOLUTIONS                          ?
?                         AZ-204 Module 1                                 ?
???????????????????????????????????????????????????????????????????????????

???????????????????????????????????????????????????????????????????????????
?                                                                         ?
?  ???????????????????  ???????????????????  ???????????????????       ?
?  ?  App Service    ?  ? Azure Functions ?  ?   Containers    ?       ?
?  ?   (PaaS)        ?  ?  (Serverless)   ?  ?   (Flexible)    ?       ?
?  ???????????????????  ???????????????????  ???????????????????       ?
?         ?                     ?                      ?                 ?
?         ?                     ?                      ?                 ?
?         v                     v                      v                 ?
?  ???????????????      ???????????????       ????????????????         ?
?  ? Web Apps    ?      ?  Triggers   ?       ?     ACI      ?         ?
?  ? API Apps    ?      ?  Bindings   ?       ?     AKS      ?         ?
?  ? Mobile Apps ?      ?  Durable    ?       ?Container Apps?         ?
?  ???????????????      ???????????????       ????????????????         ?
?                                                                         ?
???????????????????????????????????????????????????????????????????????????
```

---

## ?? Decision Tree: Which Service to Use?

```
                    Start Here
                        ?
                        ?
          ?????????????????????????????
          ?                           ?
    Need containers?              Simple web app?
          ?                           ?
          ?                           ?
      ?????????                  ???????????
      ?       ?                  ?         ?
     YES     NO                 YES       NO
      ?       ?                  ?         ?
      v       v                  v         v
    ACI?    Event              App      Function
    AKS?   Processing?       Service   Processing?
  ContApp?     ?                          ?
      ?        ?                          ?
      ?        v                          v
      ?    Functions                  Durable
      ?                              Functions
      ?
      v
  ?????????????????????
  ? Simple container? ?
  ?      YES ? ACI    ?
  ?                   ?
  ? Microservices?    ?
  ?  Simple ? C.Apps  ?
  ?  Complex ? AKS    ?
  ?????????????????????
```

---

## ?? Enterprise E-Commerce Architecture

```
                        Internet
                           ?
                           ?
                    ???????????????
                    ?  Azure CDN  ?
                    ? (Static)    ?
                    ???????????????
                           ?
                    ???????????????????
                    ? Traffic Manager ?
                    ? (Global LB)     ?
                    ????????????????????
                            ?
        ?????????????????????????????????????????
        ?                                        ?
??????????????????                      ??????????????????
?  Region: East  ?                      ?  Region: West  ?
?                ?                      ?                ?
? ?????????????? ?                      ? ?????????????? ?
? ? App Gateway? ?                      ? ? App Gateway? ?
? ? + WAF      ? ?                      ? ? + WAF      ? ?
? ?????????????? ?                      ? ?????????????? ?
?       ?        ?                      ?       ?        ?
? ?????????????? ?                      ? ?????????????? ?
? ?App Service ? ?                      ? ?App Service ? ?
? ?  (Scale)   ? ?                      ? ?  (Scale)   ? ?
? ?????????????? ?                      ? ?????????????? ?
?       ?        ?                      ?       ?        ?
? ?????????????? ?                      ? ?????????????? ?
? ?  Redis     ? ?                      ? ?  Redis     ? ?
? ?  Cache     ? ?                      ? ?  Cache     ? ?
? ?????????????? ?                      ? ?????????????? ?
?       ?        ?                      ?       ?        ?
? ?????????????? ?                      ? ?????????????? ?
? ? Azure SQL  ????????????????????????????Azure SQL  ? ?
? ?(Geo-Replic)? ?                      ? ?(Geo-Replic)? ?
? ?????????????? ?                      ? ?????????????? ?
??????????????????                      ??????????????????
        ?                                        ?
        ??????????????????????????????????????????
                         ?
                    ????????????
                    ? Functions?
                    ? (Process)?
                    ????????????
```

---

## ?? Durable Functions: Saga Pattern

```
???????????????????????????????????????????????????????????????????
?                   Order Processing Saga                         ?
???????????????????????????????????????????????????????????????????

     HTTP POST                        
         ?                            
         v                            
    ???????????                       
    ?Starter  ?                       
    ?Function ?                       
    ???????????                       
         ?                            
         v                            
    ???????????????????               
    ?  Orchestrator   ?               
    ?   Function      ?               
    ???????????????????               
         ?                            
         ????????????????????????????????????????????????????
         ?                  ?                 ?             ?
         v                  v                 v             v
    ???????????       ???????????      ???????????   ???????????
    ?Validate ?       ?Reserve  ?      ?Process  ?   ?Initiate ?
    ? Order   ?       ?Inventory?      ?Payment  ?   ?Shipping ?
    ???????????       ???????????      ???????????   ???????????
         ?                  ?                 ?             ?
         ?                  ?                 ?             ?
         ????????????????????????????????????????????????????
         ?                                                   ?
         v                                                   v
    ???????????                                         ???????????
    ? SUCCESS ?                                         ? FAILURE ?
    ???????????                                         ???????????
         ?                                                   ?
         ?                                                   v
         ?                                         ????????????????????
         ?                                         ? Compensations:   ?
         ?                                         ? - Release Stock  ?
         ?                                         ? - Refund Payment ?
         ?                                         ? - Cancel Order   ?
         ?                                         ????????????????????
         ?
         v
    ???????????
    ?  Notify ?
    ?Customer ?
    ???????????
```

---

## ?? Microservices on Container Apps

```
???????????????????????????????????????????????????????????????????
?              Container Apps Environment                         ?
?              (Managed Kubernetes + Dapr)                        ?
???????????????????????????????????????????????????????????????????

    Internet
       ?
       v
????????????????
? API Gateway  ? ? External Ingress
? (Public)     ?   HTTPS + Custom Domain
????????????????
       ? Dapr Service Invocation
       ?
       ??????????????????????????????????????????????????????
       ?                             ?                      ?
       v                             v                      v
????????????????             ????????????????      ????????????????
?  Service A   ?             ?  Service B   ?      ?  Service C   ?
?  (Internal)  ?             ?  (Internal)  ?      ?  (Internal)  ?
?              ?             ?              ?      ?              ?
?  Min: 0      ?             ?  Min: 0      ?      ?  Min: 1      ?
?  Max: 10     ?             ?  Max: 5      ?      ?  Max: 3      ?
????????????????             ????????????????      ????????????????
       ?                            ?                      ?
       ? Dapr State                 ? Dapr Pub/Sub        ? Dapr Bindings
       ?                            ?                      ?
       v                            v                      v
????????????????             ????????????????      ????????????????
?Azure Cache   ?             ?Service Bus   ?      ?   Blob       ?
?for Redis     ?             ?              ?      ?  Storage     ?
????????????????             ????????????????      ????????????????

Auto-scaling triggers:
Service A: HTTP requests (KEDA)
Service B: Service Bus queue depth (KEDA)
Service C: Always running (min: 1)
```

---

## ?? Blue-Green Deployment Flow

```
???????????????????????????????????????????????????????????????????
?                    App Service Deployment                       ?
???????????????????????????????????????????????????????????????????

Phase 1: Current State
????????????????????????
?   Production Slot    ? ???? 100% Traffic
?   Version 1.0        ?
????????????????????????

????????????????????????
?   Staging Slot       ? ???? 0% Traffic
?   (Empty)            ?
????????????????????????


Phase 2: Deploy to Staging
????????????????????????
?   Production Slot    ? ???? 100% Traffic
?   Version 1.0        ?
????????????????????????

????????????????????????
?   Staging Slot       ? ???? 0% Traffic
?   Version 2.0        ? ???? Health Check
????????????????????????


Phase 3: Progressive Rollout
????????????????????????
?   Production Slot    ? ???? 90% Traffic
?   Version 1.0        ?
????????????????????????

????????????????????????
?   Staging Slot       ? ???? 10% Traffic
?   Version 2.0        ? ???? Monitor
????????????????????????


Phase 4: Increase Traffic
????????????????????????
?   Production Slot    ? ???? 50% Traffic
?   Version 1.0        ?
????????????????????????

????????????????????????
?   Staging Slot       ? ???? 50% Traffic
?   Version 2.0        ? ???? Monitor
????????????????????????


Phase 5: Complete Swap
????????????????????????
?   Production Slot    ? ???? 100% Traffic
?   Version 2.0        ? ? Success
????????????????????????

????????????????????????
?   Staging Slot       ? ???? 0% Traffic
?   Version 1.0        ? (Rollback Ready)
????????????????????????
```

---

## ? AKS Production Architecture

```
???????????????????????????????????????????????????????????????????
?                    AKS Cluster Architecture                     ?
???????????????????????????????????????????????????????????????????

                       Azure Load Balancer
                              ?
                              ?
                    ?????????????????????
                    ?  Ingress (NGINX)  ?
                    ?  + cert-manager   ?
                    ?????????????????????
                              ?
        ?????????????????????????????????????????????
        ?                     ?                     ?
        v                     v                     v
   ???????????          ???????????          ???????????
   ?  Pod 1  ?          ?  Pod 2  ?          ?  Pod 3  ?
   ?  (App)  ?          ?  (App)  ?          ?  (App)  ?
   ???????????          ???????????          ???????????
        ?                    ?                     ?
        ????????????????????????????????????????????
                              ?
                              v
                    ????????????????????
                    ?   Service        ?
                    ?   (ClusterIP)    ?
                    ????????????????????

???????????????????????????????????????????????????????????????????
?                      Node Pools                                 ?
?                                                                 ?
?  System Pool (CriticalAddonsOnly)      User Pool               ?
?  ????????????????????????????????    ???????????????????????? ?
?  ? Node 1 (Zone 1)              ?    ? Node 1 (Zone 1)      ? ?
?  ? - CoreDNS                    ?    ? - App Pods           ? ?
?  ? - Metrics Server             ?    ? - HPA: 2-10 pods     ? ?
?  ? - Azure Policy               ?    ?                      ? ?
?  ????????????????????????????????    ???????????????????????? ?
?  ? Node 2 (Zone 2)              ?    ? Node 2 (Zone 2)      ? ?
?  ? - System Components          ?    ? - App Pods           ? ?
?  ????????????????????????????????    ???????????????????????? ?
?  ? Node 3 (Zone 3)              ?    ? Node 3 (Zone 3)      ? ?
?  ? - System Components          ?    ? - App Pods           ? ?
?  ????????????????????????????????    ???????????????????????? ?
?                                                                 ?
?  Auto-scale: 2-5 nodes              Auto-scale: 1-10 nodes     ?
???????????????????????????????????????????????????????????????????

External Services:
?? Azure Container Registry (ACR)
?? Azure Key Vault (CSI Driver)
?? Azure Monitor (Container Insights)
?? Azure Defender (Security)
```

---

## ?? Security Architecture

```
???????????????????????????????????????????????????????????????????
?                   Security Layers                               ?
???????????????????????????????????????????????????????????????????

Layer 1: Network Security
    ??????????????????????????????
    ?  Azure Front Door + WAF    ? ? DDoS Protection
    ?  Application Gateway        ?
    ??????????????????????????????
                 ?
                 v
    ??????????????????????????????
    ?  VNet Integration          ?
    ?  Private Endpoints         ?
    ?  NSG Rules                 ?
    ??????????????????????????????

Layer 2: Identity & Access
                 ?
                 v
    ??????????????????????????????
    ?  Azure AD Integration      ?
    ?  Managed Identity          ?
    ?  RBAC                      ?
    ??????????????????????????????

Layer 3: Application
                 ?
                 v
    ??????????????????????????????
    ?  App Service / Functions   ?
    ?  AKS / Container Apps      ?
    ?  ?? Authentication        ?
    ?  ?? Authorization         ?
    ?  ?? Input Validation      ?
    ??????????????????????????????

Layer 4: Data
                 ?
                 v
    ??????????????????????????????
    ?  Azure Key Vault           ? ? Secrets, Keys, Certs
    ?  ?? Connection Strings    ?
    ?  ?? API Keys              ?
    ?  ?? Certificates          ?
    ??????????????????????????????
                 ?
                 v
    ??????????????????????????????
    ?  Data Encryption           ?
    ?  ?? At Rest (TDE)         ?
    ?  ?? In Transit (TLS)      ?
    ?  ?? Customer-Managed Keys ?
    ??????????????????????????????

Layer 5: Monitoring
    ??????????????????????????????
    ?  Azure Monitor             ?
    ?  Application Insights      ?
    ?  Azure Security Center     ?
    ?  Azure Sentinel            ?
    ??????????????????????????????
```

---

## ?? Monitoring & Observability Stack

```
???????????????????????????????????????????????????????????????????
?                  Observability Architecture                     ?
???????????????????????????????????????????????????????????????????

                    Azure Resources
    ??????????????????????????????????????????????
    ?App Svc ?Functions?  ACI  ?  AKS  ?C. Apps ?
    ??????????????????????????????????????????????
        ?        ?        ?        ?        ?
        ?????????????????????????????????????
                      ?
                      v
        ???????????????????????????????
        ?  Application Insights       ?
        ?  ?? Request Tracking        ?
        ?  ?? Dependencies            ?
        ?  ?? Exceptions              ?
        ?  ?? Custom Events           ?
        ?  ?? Live Metrics            ?
        ???????????????????????????????
                      ?
                      v
        ???????????????????????????????
        ?  Log Analytics Workspace    ?
        ?  ?? Container Insights      ?
        ?  ?? VM Insights             ?
        ?  ?? Network Insights        ?
        ?  ?? KQL Queries             ?
        ???????????????????????????????
                      ?
        ???????????????????????????????
        ?                             ?
        v                             v
???????????????????         ???????????????????
?  Azure Monitor  ?         ?  Workbooks      ?
?  Alerts         ?         ?  Dashboards     ?
?  ?? Metric      ?         ?  ?? Performance ?
?  ?? Log         ?         ?  ?? Availability?
?  ?? Smart       ?         ?  ?? Usage       ?
???????????????????         ???????????????????
         ?
         v
???????????????????
?  Action Groups  ?
?  ?? Email       ?
?  ?? SMS         ?
?  ?? Webhook     ?
?  ?? Logic App   ?
???????????????????
```

---

## ?? Cost Optimization Architecture

```
???????????????????????????????????????????????????????????????????
?              Cost Optimization Strategies                       ?
???????????????????????????????????????????????????????????????????

Development Environment
    ??????????????????????????????
    ? App Service: Basic (B1)    ? ? $13/month
    ? Functions: Consumption     ? ? Pay-per-execution
    ? AKS: 1-node cluster        ? ? $70/month
    ??????????????????????????????
              Cost: ~$100/month


Production Environment
    ??????????????????????????????
    ? App Service: Standard (S1) ? ? $70/month
    ? + Auto-scaling (1-5)       ? ? Scale down off-hours
    ?                            ?
    ? Functions: Premium (EP1)   ? ? $150/month
    ? + Pre-warmed instances     ? ? No cold start
    ?                            ?
    ? AKS: Multi-node (3-10)     ? ? $500/month
    ? + Spot VMs for batch       ? ? 60-80% savings
    ? + Cluster autoscaler       ? ? Scale to demand
    ?                            ?
    ? Container Apps             ? ? $100/month
    ? + Scale to zero            ? ? Pay only when used
    ? + KEDA auto-scaling        ? ? Event-driven
    ??????????????????????????????
              Cost: ~$1,000/month
              (with optimization)

Reserved Instances (1-year commitment)
    ??????????????????????????????
    ? App Service S1             ? ? 30% savings
    ? VM instances for AKS       ? ? 40% savings
    ??????????????????????????????
              Total Savings: ~$300/month
```

---

These diagrams provide visual references for all major concepts in Module 1! ??
